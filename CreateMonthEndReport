{
    "AWSTemplateFormatVersion" : "2010-09-09",
    "Description"  : "This stack will create 2 SQS Queues and 2 Lambda function to get data from PI RDS send it to a queue to get polled by on-premise server, and poll the data from a queue that receives message from on-premise server.",

    "Parameters"  : {
        "RDSHOST" : {
            "Type" : "String",
            "Description" : "RDS Host info"
        },
        "RDSUSER" : {
            "Type" : "String",
            "Description" : "RDS User"
        },
        "RDSPASSWORD" : {
            "Type" : "String",
            "Description" : "RDS Password"
        },
        "RDSDB" : {
            "Type" : "String",
            "Description" : "RDS DB Name"
        },
        "S3KEYMONTHEND" : {
            "Type" : "String",
            "Description" : "zip file key name for MonthEndReport Lambda function"
        }
    },
    "Resources" : {
        "GetMonthEndDataPublishshtoSQS" : {
            "Type" : "AWS::Lambda::Function",
            "Properties" : {
                "Code" : {
                    "S3Bucket" : "generalfilesbackfit",
                    "S3Key" : {"Ref" :"S3KEYMONTHEND"}
                },
                "FunctionName" : "GetMonthEndDataPublishshtoSQS",
                "Layers" : ["arn:aws:lambda:us-west-2:849779278892:layer:pymysql:2"],
                "PackageType" : "Zip",
                "Role" : "arn:aws:iam::849779278892:role/LambdaExecRole",
                "Runtime" : "python3.8",
                "Handler" : "lambda_function.lambda_handler",
                "Timeout" : 30,
                "Environment" : {
                    "Variables" : {"RDS_HOST":{"Ref":"RDSHOST"},
                                   "RDS_USER":{"Ref":"RDSUSER"},
                                   "RDS_PASSWORD":{"Ref":"RDSPASSWORD"},
                                   "RDS_DB":{"Ref":"RDSDB"}}
                },
                "VpcConfig" : {
                    "SecurityGroupIds" : ["sg-0d7cbccb4dcf5ccfb"],
                    "SubnetIds": ["subnet-027652c27ddc0fe90"]
                }
            }
        }
    }   
}